# FastAPI Image Management Application

Это асинхронное приложение на FastAPI, использующее RabbitMQ для обработки сообщений и PostgreSQL в качестве базы данных. Приложение поддерживает аутентификацию с помощью JWT токенов.

## Описание проекта

Проект представляет собой RESTful API, который позволяет создавать, читать, обновлять и удалять изображения. API использует RabbitMQ для обработки сообщений и PostgreSQL в качестве базы данных.

## Структура проекта

.<br>
├── main.py # Основной код приложения<br>
├── api/ # Определение маршрутов API<br>
├── auth/ # Аутентификация<br>
├── certs/ # Место хранения публичного и приватного ключей<br>
├── core/ # Конфигурации настройки приложения и модели базы данных<br>
├── rabbitmq/ # Логика работы с RabbitMQ<br>
├── alembic/ # Миграции базы данных Alembic<br>
│ └── versions/ # Версии миграций<br>
├── Dockerfile # Конфигурация Docker для приложения<br>
└── docker-compose.yml # Конфигурация Docker Compose для запуска приложения<br>

# Подготовка к запуску

Для запуска проекта необходимо выполнить следующие действия:

## 1.Создание виртуального хоста

Если виртуальный хост еще не создан, необходимо создать его вручную:

1. Подключитесь к RabbitMQ Management UI (доступен по адресу `http://localhost:15672`).
2. Войдите с использованием учетных данных.
3. Перейдите на вкладку "Admin".
4. В разделе "Virtual Hosts" нажмите "Add a new virtual host".
5. Введите имя виртуального хоста и нажмите "Add virtual host".

##  Доступ к RabbitMQ

После запуска приложения необходимо зайти в RabbitMQ.

1. Подключитесь к RabbitMQ Management UI (доступен по адресу `http://localhost:15672`).
2. Вйдите с использованием учетных данных которые вы указали в файле `docker-compose.yml`.


## 2.Создание базы данных

Для создания таблиц в базе данных необходимо выполнить следующую команду из папки fastapi_application:
так же миграции будут применены автоматически при запуске приложения.

```bash
docker ps
```
берем имя контейнера
```bash
docker exec -it <имя_контейнера> /bin/bash
```

```bash
cd fastapi_application
```

```bash
alembic upgrade head
```
миграция уже находится в папке alembic/versions

## 3. Генерация токенов

Для генерации токенов необходимо выполнить следующую команду из папки fastapi-application:

```shell
# Генерация RSA приватного ключа
openssl genrsa -out jwt-private.pem 2048
```

```shell
# Генерация RSA публичного ключа
openssl rsa -in jwt-private.pem -outform PEM -pubout -out jwt-public.pem
```

ключи должны находится в папке fastapi-application/certs

## Запуск приложения

Для запуска приложения используйте Docker Compose. Перейдите в папку с проектом и выполните следующую команду:

```bash
docker-compose up --build
```


# Инструкция по использованию API

Данный API предоставляет возможность работы с изображениями, включая создание, получение, обновление и удаление изображений, а также аутентификацию пользователей.

## Базовый URL

http://0.0.0.0:8000/api/v1/

## Эндпоинты

### 1. Получение изображений

- **Получить список всех изображений**
  - **Метод:** GET
  - **URL:** `/get_all`
  - **Пример запроса:**
    ```
    GET http://0.0.0.0:8000/api/v1/get_all
    ```

- **Получить изображение по ID**
  - **Метод:** GET
  - **URL:** `/get/{id}`
  - **Пример запроса:**
    ```
    GET http://0.0.0.0:8000/api/v1/get/{id}
    ```

### 2. Создание изображений

- **Создать новое изображение**
  - **Метод:** POST
  - **URL:** `/create/`
  - **Тело запроса (JSON):**
    ```json
    {
      "title": "string",
      "file_path": "string",
      "resolution": "string",
      "size": 0
    }
    ```
  - **Пример запроса:**
    ```
    POST http://0.0.0.0:8000/api/v1/create/
    ```

### 3. Обновление изображений

- **Обновить изображение**
  - **Метод:** PUT
  - **URL:** `/update/`
  - **Тело запроса (JSON):**
    ```json
    {
      "title": "new title",
      "file_path": "home",
      "resolution": "800x600",
      "size": 1024
    }
    ```
  - **Пример запроса:**
    ```
    PUT http://0.0.0.0:8000/api/v1/update/
    ```

### 4. Удаление изображений

- **Удалить изображение**
  - **Метод:** DELETE
  - **URL:** `/delete/`
  - **Пример запроса:**
    ```
    DELETE http://0.0.0.0:8000/api/v1/delete/
    ```

## Аутентификация

### 1. Регистрация пользователя

- **Создать пользователя**
  - **Метод:** POST
  - **URL:** `/register`
  - **Тело запроса (JSON):**
    ```json
    {
      "username": "string",
      "password": "string"
    }
    ```
  - **Пример запроса:**
    ```
    POST http://0.0.0.0:8000/api/v1/register
    ```

### 2. Вход в систему

- **Выпуск токена**
  - **Метод:** POST
  - **URL:** `/auth/login`
  - **Тело запроса (JSON):**
    ```json
    {
      "username": "string",
      "password": "string"
    }
    ```
  - **Пример запроса:**
    ```
    POST http://0.0.0.0:8000/api/v1/auth/login
    ```